# tunnel-flow

假设有两台计算机 A 和 B，其中 A 具有公网 IP，并绑定了域名 example.com。A 上启动了一个“反向隧道”服务端，其中：

- 端口 8284 用于与客户端通信，采用 TCP 协议。
- 端口 8084 用于提供 HTTP 服务。

B 是位于局域网内的计算机，B 上运行着一个监听 8080 端口的 HTTP 服务，并启动了“反向隧道”客户端。

目标是：当外部通过访问 example.com:8084/sessionID 时，A 的反向隧道能够将 HTTP 请求转发到 B 的 8080 端口。

## 具体需求：

1. A 的“反向隧道”需要监听 8084 端口，并将接收到的 HTTP 请求转发至 B 的 8080 端口。
2. B 的“反向隧道”客户端需要保持与 A 的连接，确保请求能够从 A 正确转发到 B 本地服务。
3. 开发时，需考虑如何区分并转发不同类型的请求（如 HTTP、TCP 等）以及如何保证连接的稳定性。
4. 要求使用 golang 开发，使用 yamux 实现连接多路复用，允许多个请求在同一连接上并行处理。

假设有两台计算机 A 和 B，其中 A 在外网，B 在内网。B 上有一个 HTTP 服务 S1 和一个 TCP 服务 S2，现想要在其他地方通过以 A 作为代理隧道来访问 B 上的 S1 和 S2 服务。

## 设计思路：

1. 要求使用 golang 开发，使用 yamux 实现连接多路复用，允许多个请求在同一连接上并行处理
2. A 和 B 之间建立 TCP 长连接通信。
3. 当 B 连上 A 时，A 会为 B 分配一个 ClientID；同时 B 向 A 提供自身的服务名称列表（如 S1、S2 的名称）。
4. A 要维护一个会话管理池，通过 ClientID 与 B 建立映射关系。
   - 包含 B 的 连接信息
   - 包含 B 提供的服务名称列表（如 S1、S2 的名称）
5. B 要维护一个自身服务列表的端口号和协议类型。
6. B 仅在与 A 建立通信时发送 Token 验证，验证成功后，B 不再向 A 发送报文，
   - 之后的报文均为 A 主动向 B 发送的转发请求。
7. 考虑扩展性：
   - 支持多种协议（如 HTTP、TCP 等）的转发
   - 支持 token 认证

## 目录结构：

```
tunnel-flow/
├── cmd/
│ ├── client/客户端代码
│ └── server/服务端代码
├── config/配置相关
├── tunnel/隧道相关
├── util/工具类
```

请根据以上需求，帮我实现这样的一个通用的反向隧道功能。
