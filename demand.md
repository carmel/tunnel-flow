## 设计需求说明

### 目标：

开发一个基于 Golang 的隧道代理系统，允许用户通过位于外网的计算机 A 转发请求到位于内网的计算机 B 上的服务。系统要求支持多种协议（如 HTTP、TCP 等）的转发，并具备高效的多路复用、会话管理以及身份认证等功能。

### 关键技术栈：

- Golang：主要开发语言。
- Yamux：实现连接多路复用，允许多个请求在同一连接上并行处理。
- TCP 长连接：A 和 B 之间通过持久化的 TCP 长连接进行通信。
- Token 认证：通过 Token 实现客户端和服务端的身份认证。

### 系统架构：

- A（外网端）：代理隧道服务，负责与 B 建立连接并转发流量。
- B（内网端）：提供多个服务（如 HTTP 服务 S1、TCP 服务 S2），等待 A 的请求转发。

### 设计思路：

1. 建立连接：

- B 与 A 建立 TCP 长连接并保持持久连接。
- A 会为每个连接的 B 分配一个唯一的 ClientID，用于会话管理。
- 在初次连接时，B 向 A 提供 Token 进行身份验证。
- 如果验证成功，B 不再向 A 发送任何消息，所有后续通信都由 A 主动向 B 发起。

2. 会话管理：

- A 维护一个会话池，通过 ClientID 管理与 B 的映射关系，确保能够高效管理多个连接。
- 会话池记录每个 B 的连接信息和服务列表，支持动态更新。

3. 数据转发：

- A 根据请求的服务名称，将请求转发到对应的 B 服务。
- B 根据服务名称自动决定使用哪个服务来处理请求。
- 支持多协议转发，包括 HTTP 和 TCP 请求，且每个请求可以并发处理。
- 使用 Yamux 进行多路复用，提升效率。

4. Token 认证：

- 所有客户端请求需要通过 Token 进行身份验证，确保安全性。
- A 在接受 B 的连接时，进行一次 Token 验证。验证通过后，B 不再主动发送报文，之后的通信都由 A 发起。
- A 负责 Token 的生成和验证，确保只有合法的 B 能够连接到 A。

### 目录结构

```plaintext
tunnel-flow/
├── cmd/
│ ├── client/          # 客户端代码，处理连接 A 和 B 的业务逻辑，发起请求到 B
│ └── server/          # 服务端代码，接收来自 A 的连接请求并管理隧道流量
├── config/            # 配置文件，包括端口、协议等配置信息
├── tunnel/            # 隧道相关逻辑，主要包含数据转发、路由、连接管理等
├── util/              # 工具类，通用功能模块（如认证、加解密、日志等）
└── README.md          # 项目文档，包含基本使用和配置说明
```

请基于以上需求，实现一个 MVP 版本的反向隧道。
